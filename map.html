<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Radiation Point-Intensity Map</title>

    <!-- Leaflet core -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

    <!-- PapaParse (CSV/TSV) -->
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js" defer></script>

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" defer></script>

    <!-- Tailwind dark UI -->
    <script src="https://cdn.tailwindcss.com?plugins=typography" defer></script>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      #map {
        height: calc(100vh - 3.5rem);
      }
      /* Bigger, dark pop-ups with high-contrast text */
      .leaflet-popup-content-wrapper {
        background: #1f2937;
        color: #ffffff;
        border-radius: 0.75rem;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
      }
      .leaflet-popup-tip {
        background: #1f2937;
      }
      .leaflet-popup-content {
        width: 500px; /* bigger popup */
      }
      strong {
        color: #fffbfb;
      }
      .prose {
        color: #ffffff;
      }
      .prose strong {
        color: #ffffff;
      }
      .leaflet-control-coordinate {
        background: rgba(31, 41, 55, 0.8);
        color: #fff;
        padding: 2px 6px;
        border-radius: 0.25rem;
        font-size: 0.75rem;
      }
      #legend {
        pointer-events: none;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200 pt-14">

    <div id="nav-placeholder"></div>

    <button
      id="toggleSidebar"
      class="fixed top-16 left-4 bg-gray-800/80 text-gray-100 p-2 rounded-md md:hidden z-[1001]"
    >
      ☰
    </button>
    <div
      id="legend"
      class="fixed bottom-24 right-4 bg-gray-800/80 text-gray-100 p-2 rounded-md text-xs z-[1000] hidden"
    >
      <div id="legend-label" class="text-center mb-1">Dose (µSv/h)</div>
      <div id="legend-bar" class="h-2 w-32 rounded mb-1" style="background: linear-gradient(to right, green, red);"></div>
      <div class="flex justify-between">
        <span id="legend-min">0</span>
        <span id="legend-max">0</span>
      </div>
    </div>
    <div class="flex h-screen">
      <div id="map" class="flex-1"></div>
      <aside
        id="sidebar"
        class="fixed top-14 left-0 h-full w-72 max-w-full bg-gray-800/90 backdrop-blur-md p-4 space-y-4 overflow-y-auto transform -translate-x-full transition-transform z-[1000] md:relative md:translate-x-0 md:w-72 md:bg-opacity-100 text-gray-200"

      >
        <h2 class="text-lg font-semibold mb-2">Tracks</h2>
        <ul id="trackList" class="space-y-2 text-sm"></ul>
        <div>
          <label for="metricSelect" class="block mb-1 font-medium">Metric</label>
          <select
            id="metricSelect"
            class="bg-gray-700 border border-gray-600 rounded-md px-2 py-1 w-full focus:outline-none"
          >
            <option value="dose">Dose (µSv/h)</option>
            <option value="cps">Counts (cps)</option>
          </select>
        </div>
        <div>
          <label for="basemapSelect" class="block mb-1 font-medium">Map style</label>
          <select
            id="basemapSelect"
            class="bg-gray-700 border border-gray-600 rounded-md px-2 py-1 w-full focus:outline-none"
          >
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="topo">Topographic</option>
            <option value="osm">OSM</option>
            <option value="hot">OSM HOT</option>
          </select>
        </div>
        <div>
          <label class="flex items-center gap-2 text-gray-200" for="trackViewToggle">
            <input type="checkbox" id="trackViewToggle" class="accent-blue-500" /> Track view
          </label>
        </div>
        <div>
          <label for="startTime" class="block mb-1 font-medium">Start time</label>
          <input
            type="datetime-local"
            id="startTime"
            class="bg-gray-700 border border-gray-600 rounded-md px-2 py-1 w-full focus:outline-none"
          />
        </div>
        <div>
          <label for="endTime" class="block mb-1 font-medium">End time</label>
          <input
            type="datetime-local"
            id="endTime"
            class="bg-gray-700 border border-gray-600 rounded-md px-2 py-1 w-full focus:outline-none"
          />
        </div>
        <div id="errorMessage" class="text-red-400 text-sm hidden"></div>

      </aside>
      <!-- Full screen track popup -->
      <div
        id="trackPopup"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-[1002] flex items-center justify-center p-4"
      >
        <div
          id="trackPopupContent"
          class="relative bg-gradient-to-br from-gray-800 to-gray-700 text-white p-6 overflow-auto max-w-6xl max-h-full w-full rounded-xl shadow-2xl ring-1 ring-gray-500/50"
        >
          <button
            id="trackPopupClose"
            class="absolute top-2 right-2 text-gray-300 hover:text-white"
          >
            ✕
          </button>
        </div>
      </div>
    </div>

    <script src="map.js" defer></script>

  </body>
</html>
